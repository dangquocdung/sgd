(dp1
S'output'
p2
S"<type 'exceptions.TypeError'> cannot concatenate 'str' and 'NoneType' objects"
p3
sS'layer'
p4
S'C:\\www-sgd114\\applications\\sgd\\controllers/portal.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\n\nfrom plugin_cms import Cms\ncms = Cms()\n\n# seconds = cms.get_lasttime()\n# if seconds != request.vars.key:\n\t# vars = request.vars\n\t# vars["key"] = seconds\n\t# redirect(URL(args=request.args,vars=vars))\n\t\ndef index():\n\tredirect(URL(f=\'folder\',args=request.args))\n\t\n#@cache.action(time_expire=3600, cache_model=cache.disk, quick=\'SVP\')\ndef folder():\n\ttry:\n\t\tresponse.view = \'layout/%s\'%(cms.layout_folder() or \'folder.html\')\n\texcept:\n\t\tresponse.view = \'layout/trangchu.html\'\n\treturn response.render(dict())\n\t\n#@cache.action(time_expire=3600, cache_model=cache.disk, quick=\'SVP\')\ndef read():\n\ttry:\n\t\tresponse.view = \'layout/%s\'%(cms.layout() or \'content.html\')\n\texcept:\n\t\tresponse.view = \'layout/trangchu.html\'\n\treturn response.render(dict())\t\n\t\n\t\ndef search():\n\tdcontent = cms.define_table(tablename =\'dcontent\')\n\ttxt = request.vars.key_search\n\tsearch_folder = request.args(0)\n\tif request.vars.search_select:\n\t\tsearch_folder = request.vars.search_select\n\tquery = dcontent.textcontent.like(\'%\'+str(txt)+\'%\')\n\tif search_folder:\n\t\tfrom plugin_cms import CmsFolder\n\t\tfolder = CmsFolder().get_folder(search_folder)\n\t\tquery &= (dcontent.folder.belongs(CmsFolder().get_folders(folder)))\n\trows= cms.db(query).select()\n\t\n\tdiv = DIV(_id=\'list_news\')\n\t\n\tif len(rows)>0:\n\t\tdiv.append(H2(len(rows),T(\' K\xe1\xba\xbft qu\xe1\xba\xa3 t\xc3\xacm ki\xe1\xba\xbfm cho t\xe1\xbb\xab kh\xc3\xb3a: "\'),request.vars.key_search,\'"\',_id=\'title_search_\'))\n\t\tul=UL(_class=\'wr_search\')\n\t\tfor row in rows:\n\t\t\tulr_link =\'\'\n\t\t\tif row.dtable == \'san_pham\':\n\t\t\t\tsan_pham = cms.define_table(\'san_pham\')\n\t\t\t\tsp = cms.db.san_pham[row.table_id]\n\t\t\t\tif sp:\n\t\t\t\t\tulr_link = URL(c=\'portal\',f=\'read\',args=[sp.r_folder.name if sp.r_folder else \'\',\'san_pham\',sp.link])\n\t\t\tif row.dtable == \'cong_ty\':\n\t\t\t\tcong_ty = cms.define_table(\'cong_ty\')\n\t\t\t\tsp = cms.db.cong_ty[row.table_id]\n\t\t\t\tif sp:\n\t\t\t\t\tulr_link = URL(c=\'portal\',f=\'folder\',args=[sp.folder.name])\n\t\t\tif row.dtable == \'tintuc\':\n\t\t\t\ttintuc = cms.define_table(\'tintuc\')\n\t\t\t\tsp = cms.db.tintuc[row.table_id]\n\t\t\t\tif sp:\n\t\t\t\t\tulr_link = URL(c=\'portal\',f=\'read\',args=[sp.folder.name,\'tintuc\',sp.link])\n\t\t\t\n\t\t\tif row.dtable == \'doanh_nghiep\':\n\t\t\t\tdoanh_nghiep = cms.define_table(\'doanh_nghiep\')\n\t\t\t\tsp = cms.db.doanh_nghiep[row.table_id]\n\t\t\t\tif sp:\n\t\t\t\t\tulr_link = URL(c=\'portal\',f=\'read\',args=[sp.folder.name,\'doanh_nghiep\',sp.link])\n\t\t\t\t\t\n\t\t\tcode = \'<span style=" background: yellow;">\'+request.vars.key_search+\'</span>\'\n\t\t\tname =  row.name.replace(request.vars.key_search,code)\n\n\t\t\t# name =  name.replace(request.vars.key_search.lower(),code)\n\t\t\t# name =  name.replace(request.vars.key_search.upper(),code)\n\t\t\tli = LI(A(XML(str(B(T(\'title_search_\'+str(row.dtable))))+": "+name),_href=ulr_link,_class=\'name\'))\n\t\t\tif row.description:\n\t\t\t\tdescription =  row.description.replace(request.vars.key_search,code)\n\t\t\t\tli.append(P(XML(description)))\n\t\t\t\n\t\t\tul.append(li)\n\t\t\t\n\t\tdiv.append(ul)\n\telse:\n\t\tdiv.append(H2(T(\'K\xe1\xba\xbft qu\xe1\xba\xa3 t\xc3\xacm ki\xe1\xba\xbfm t\xe1\xbb\xab kh\xc3\xb3a: "\'),request.vars.key_search,\'"\',_id=\'title_page\'))\n\t\tdiv.append(P(T(\'Kh\xc3\xb4ng c\xc3\xb3 k\xe1\xba\xbft qu\xe1\xba\xa3 n\xc3\xa0o cho t\xe1\xbb\xab kh\xc3\xb3a n\xc3\xa0y.\')))\n\t\t\n\treturn div\n\ndef gian_hang_search():\n\tdcontent = cms.define_table(tablename =\'dcontent\')\n\ttxt = request.vars.key_search\n\tsearch_folder = \'\'\n\tif request.vars.search_select:\n\t\tsearch_folder = request.vars.search_select\n\tquery = dcontent.textcontent.like(\'%\'+str(txt)+\'%\')\n\tif search_folder:\n\t\tfrom plugin_cms import CmsFolder\n\t\tfolder = CmsFolder().get_folder(search_folder)\n\t\tquery &= (dcontent.folder.belongs(CmsFolder().get_folders(folder)))\n\trows= cms.db(query).select()\n\t\n\tdiv = DIV(_id=\'list_news\')\n\ti = 0\n\tif len(rows)>0:\n\t\t\n\t\tul=UL(_class=\'wr_search\')\n\t\tfor row in rows:\n\t\t\tulr_link =\'\'\n\t\t\tif row.dtable == \'san_pham\':\n\t\t\t\tsan_pham = cms.define_table(\'san_pham\')\n\t\t\t\tsp = cms.db.san_pham[row.table_id]\n\t\t\t\t\n\t\t\t\tif sp:\n\t\t\t\t\tif sp.r_folder.name == request.args(0):\n\t\t\t\t\t\tulr_link = URL(c=\'portal\',f=\'read\',args=[sp.r_folder.name,\'san_pham\',sp.link])\n\t\t\t\t\t\tcode = \'<i style=" background: yellow;">\'+request.vars.key_search+\'</i>\'\n\t\t\t\t\t\tname =  row.name.replace(request.vars.key_search,code)\n\n\t\t\t\t\t\tname =  name.replace(request.vars.key_search.lower(),code)\n\t\t\t\t\t\tname =  name.replace(request.vars.key_search.upper(),code)\n\t\t\t\t\t\tli = LI(A(XML(str(B(T(\'title_search_\'+str(row.dtable))))+": "+name),_href=ulr_link,_class=\'name\'))\n\t\t\t\t\t\tdescription =  row.description.replace(request.vars.key_search,code)\n\t\t\t\t\t\tli.append(P(XML(description)))\n\t\t\t\t\t\tul.append(li)\n\t\t\t\t\t\ti+=1\n\n\t\t\tif row.dtable == \'cong_ty\':\n\t\t\t\tprint \'cong ty\'\n\t\t\t\t# cong_ty = cms.define_table(\'cong_ty\')\n\t\t\t\t# sp = cms.db.cong_ty[row.table_id]\n\t\t\t\t# if sp:\n\t\t\t\t\t# if sp.folder.name == request.args(0):\n\t\t\t\t\t\t# ulr_link = URL(c=\'portal\',f=\'folder\',args=[sp.folder.name])\n\t\t\t\t\t\t# code = \'<i style=" background: yellow;">\'+request.vars.key_search+\'</i>\'\n\t\t\t\t\t\t# name =  row.name.replace(request.vars.key_search,code)\n\n\t\t\t\t\t\t# name =  name.replace(request.vars.key_search.lower(),code)\n\t\t\t\t\t\t# name =  name.replace(request.vars.key_search.upper(),code)\n\t\t\t\t\t\t# li = LI(A(XML(str(B(T(\'title_search_\'+str(row.dtable))))+": "+name),_href=ulr_link,_class=\'name\'))\n\t\t\t\t\t\t# description =  row.description.replace(request.vars.key_search,code)\n\t\t\t\t\t\t# li.append(P(XML(description)))\n\t\t\t\t\t\t# ul.append(li)\n\t\t\t\t\t\t# i+=1\n\n\t\t\tif row.dtable == \'tintuc\':\n\t\t\t\ttintuc = cms.define_table(\'tintuc\')\n\t\t\t\tsp = cms.db.tintuc[row.table_id]\n\t\t\t\tif sp:\n\t\t\t\t\tif sp.folder.name == request.args(0):\n\t\t\t\t\t\tulr_link = URL(c=\'portal\',f=\'read\',args=[sp.folder.name,\'tintuc\',sp.link])\n\t\t\t\t\t\tcode = \'<i style=" background: yellow;">\'+request.vars.key_search+\'</i>\'\n\t\t\t\t\t\tname =  row.name.replace(request.vars.key_search,code)\n\n\t\t\t\t\t\tname =  name.replace(request.vars.key_search.lower(),code)\n\t\t\t\t\t\tname =  name.replace(request.vars.key_search.upper(),code)\n\t\t\t\t\t\tli = LI(A(XML(str(B(T(\'title_search_\'+str(row.dtable))))+": "+name),_href=ulr_link,_class=\'name\'))\n\t\t\t\t\t\tdescription =  row.description.replace(request.vars.key_search,code)\n\t\t\t\t\t\tli.append(P(XML(description)))\n\t\t\t\t\t\tul.append(li)\n\t\t\t\t\t\ti+=1\n\t\tdiv.append(H2(i,T(\' K\xe1\xba\xbft qu\xe1\xba\xa3 t\xc3\xacm ki\xe1\xba\xbfm cho t\xe1\xbb\xab kh\xc3\xb3a: "\'),request.vars.key_search,\'"\',_id=\'title_search_\'))\n\t\tdiv.append(ul)\n\telse:\n\t\tdiv.append(H2(T(\'K\xe1\xba\xbft qu\xe1\xba\xa3 t\xc3\xacm ki\xe1\xba\xbfm t\xe1\xbb\xab kh\xc3\xb3a: "\'),request.vars.key_search,\'"\',_id=\'title_page\'))\n\t\tdiv.append(P(T(\'Kh\xc3\xb4ng c\xc3\xb3 k\xe1\xba\xbft qu\xe1\xba\xa3 n\xc3\xa0o cho t\xe1\xbb\xab kh\xc3\xb3a n\xc3\xa0y.\')))\n\t\t\n\treturn div\t\t\t\t\n\t\t\t\t\ndef hoi_dap():\n\tforlder_id = cms.get_folder(request.args(0))\n\thoi_dap = cms.define_table(tablename =\'hoi_dap\',migrate=True)\n\n\thoi_dap.folder.writable=False\n\thoi_dap.folder.readable=False\n\thoi_dap.folder.default=forlder_id \n\n\thoi_dap.avatar.writable=False\n\thoi_dap.avatar.readable=False\n\thoi_dap.avatar.default=\' \' \n\n\thoi_dap.htmlcontent.writable=False\n\thoi_dap.htmlcontent.readable=False\n\n\tfrom gluon.tools import Recaptcha\n\tpublic_key=\'6LdtT_YSAAAAALCH4vbHKl1yjqvhB80JZh1J21Lv\'\n\tprivate_key=\'6LdtT_YSAAAAAI6XnBMNNWwSkJeSYtbP_-kW5HUH\' ### provided by recaptcha.net\n\n\tfrom gluon.tools import Crud\n\tcrud = Crud(cms.db)\n\tcrud.settings.captcha =  Recaptcha(request,public_key,private_key,options = "lang:\'en\', theme:\'clean\'")\n\tform=crud.create(hoi_dap) \n\n\t# form[0].insert(-1, TR(\'\', Recaptcha(request,public_key,private_key,options = "lang:\'en\', theme:\'clean\'"))) \n\n\tif form.process().accepted:\n\t\t\n\t\tfrom plugin_process import ProcessModel\n\t\tprocess = ProcessModel()\n\t\tobjects = process.define_objects(True)\n\t\tlog     = process.define_process_log(True)\n\n\t\tobjects_id =objects.insert(folder=forlder_id ,tablename=\'hoi_dap\',table_id=form.vars.id ,process=2)\n\t\tlog.insert(objects=objects_id, process=2)\n\t\tresponse.flash=T(\'done!\')\n\t\t# scr =\'\'\'<script type="text/javascript"> \n   \t\t\t\t# setInterval("location.reload();",1000);\n\t\t\t# </script>\'\'\'\n\t\t# form.append(XML(scr))\n\t# if form.errors:\n\t\t# response.flash=T(\'Loi nhap du lieu!\')\n\t\t# scr =\'\'\'<script type="text/javascript"> \n   \t\t\t\t# setInterval("location.reload();",1000);\n\t\t\t# </script>\'\'\'\n\t\t# form.append(XML(scr))\n\tdiv = DIV(_id=\'hoi_dap\')\n\tdiv.append(DIV(H2(\'Nh\xe1\xba\xadp c\xc3\xa2u h\xe1\xbb\x8fi\',_class="title_box"),_class="tinlienquan"))\n\tdiv.append(form)\n\tresponse.view = \'layout/hoi_dap_13.html\'\n\treturn dict(content=div)\n\t\n\ndef form_y_kien_du_thao():\n\tvb_du_thao=request.vars.vbdt\n\tdiv = DIV(_id=\'hoi_dap\')\n\tdiv.append(DIV(H2(\'G\xe1\xbb\xadi \xc3\xbd ki\xe1\xba\xbfn \xc4\x91\xc3\xb3ng g\xc3\xb3p\',_class="title_box"),_class="tinlienquan"))\n\t\n\tfrom gluon.tools import Recaptcha\n\tpublic_key=\'6LdtT_YSAAAAALCH4vbHKl1yjqvhB80JZh1J21Lv\'\n\tprivate_key=\'6LdtT_YSAAAAAI6XnBMNNWwSkJeSYtbP_-kW5HUH\' ### provided by recaptcha.net\n\t\n\tgop_y_du_thao = cms.define_table(tablename =\'gop_y_du_thao\',migrate=True)\n\tgop_y_du_thao.r_gop_y_du_thao.writable=False\n\tgop_y_du_thao.r_gop_y_du_thao.readable=False\n\tgop_y_du_thao.r_gop_y_du_thao.default=vb_du_thao\n\tfrom gluon.tools import Crud\n\tcrud = Crud(cms.db)\n\n\n\tform=crud.create(gop_y_du_thao) \n\tform[0].insert(-1, TR(\'\', Recaptcha(request,public_key,private_key,options = "lang:\'en\', theme:\'clean\'"))) \n\tdiv.append(form)\n\treturn div\n\n\ndef feed():\n\tfrom plugin_cms import CmsFolder\n\tfolder_id = CmsFolder().get_folder()\n\tar_entries =[]\n\tentries =  CmsFolder().get_rows(folder=request.args(0))\n\tlink_page=\'http://\'+request.env.http_host\n\tfor entry in entries:\n\t\tlink = CmsFolder().url_content(entry)\n\t\tdescription = str(entry.description)\n\t\tif entry.avatar:\n\t\t\tdescription = \'<a href="\'+link_page + str(link)+\'"><img>\'+str(entry.avatar) +\'</img></a>\'+ description\n\t\tar_entries.append(dict(title = entry.name.decode(\'utf-8\'),\n\t\t\tlink = link_page + str(link),\n\t\t\tdescription=XML(description.decode(\'utf-8\')),\n\t\t\tcreated_on = entry.publish_on))\n\treturn \'\'\n\treturn dict(title=\'SOYTE FEED\',link=link_page,description=\'SOYTE.HATINH.GOV.VN\', created_on = request.now,entries=ar_entries )\n\t\n\ndef add_cart():\n\tpid = request.vars.pid\n\tar_carts =[]\n\tif request.cookies.has_key (\'cart_shop\'):\n\t\tcarts = eval(request.cookies[\'cart_shop\'].value)\n\t\ti=0\n\t\tfor cart in carts:\n\t\t\tcart = eval(cart)\n\t\t\tif cart[\'id\']==pid:\n\t\t\t\tar_carts.append(str({\'id\':str(cart[\'id\']) ,\'num\':str(int(cart[\'num\'])+1)}))\n\t\t\t\ti+=1\n\t\t\telse:\n\t\t\t\tar_carts.append(str({\'id\':str(cart[\'id\']) ,\'num\':str(cart[\'num\'])}))\n\t\tif i==0:\n\t\t\tar_carts.append(str({\'id\':pid ,\'num\':str(1)}))\n\telse:\n\t\tar_carts.append(str({\'id\':pid ,\'num\':str(1)}))\n\t\t\n\tresponse.cookies[\'cart_shop\'] = str(ar_carts) \n\tresponse.cookies[\'cart_shop\'][\'expires\'] = 24 * 3600\n\tresponse.cookies[\'cart_shop\'][\'path\'] = \'/\'\n\tresponse.flash = T("Add new cart!")\n\t\n\t# load view_carts() nhung ko request duoc cookies moi\n\t\n\tdiv = DIV()\n\tnum_car = 0\n\ttong_tien = 0\n\tcarts = ar_carts\n\tfrom plugin_cms import CmsModel\n\tfrom plugin_cms import CmsFolder\n\tcms = CmsModel()\n\tdb = cms.db\n\tcms.define_table(\'san_pham\')\n\tfrom plugin_app import number_format\n\t\n\tfor cart in carts:\n\t\tcart = eval(cart)\n\t\trow  = db((db.san_pham.id==cart[\'id\'])).select().first()\n\t\tif row:\n\t\t\tdiv1 = DIV(_class=\'list_cart\')\n\t\t\tul = UL()\n\t\t\tul.append(LI(row.name))\n\t\t\tul.append(LI(SPAN(\'S\xe1\xbb\x91 l\xc6\xb0\xe1\xbb\xa3ng: \'),cart[\'num\']))\n\t\t\tul.append(LI(SPAN(\'Gi\xc3\xa1: \'),number_format(row.gia_san_pham),\' VN\xc4\x90\'))\n\t\t\tdiv1.append(DIV(IMG(_src=cms.get_avatar(\'san_pham\',row.avatar),_class=\'thumbnail\'),_class=\'col-md-4 box_ivinh\'))\n\t\t\tdiv1.append(DIV(ul,_class=\'col-md-8 box_ivinh\'))\n\t\t\tdiv.append(div1)\n\t\t\tdiv.append(HR())\n\t\t\ttong_tien += int(row.gia_san_pham)* int(cart[\'num\'])\n\t\t\tnum_car +=1\n\tp_tong = DIV(SPAN(\'T\xe1\xbb\x95ng ti\xe1\xbb\x81n: \'))\n\tp_tong.append(str(number_format(tong_tien))+\' VN\xc4\x90\')\n\tdiv.append(B(p_tong,_class=\'text-right\'))\n\tdiv.append(A(\'G\xe1\xbb\xadi \xc4\x91\xc6\xa1n h\xc3\xa0ng\',_href=URL(c=\'portal\',f=\'folder\',args=[\'checkout\']),_class=\'btn btn-success\'))\n\treturn div\n\t\ndef add_cart_r_number():\n\tpid = request.vars.pid\n\tar_carts =[]\n\tnum_carts = 0\n\tif request.cookies.has_key (\'cart_shop\'):\n\t\tcarts = eval(request.cookies[\'cart_shop\'].value)\n\t\ti=0\n\t\t\n\t\tfor cart in carts:\n\t\t\tnum_carts +=1\n\t\t\tcart = eval(cart)\n\t\t\tif cart[\'id\']==pid:\n\t\t\t\tar_carts.append(str({\'id\':str(cart[\'id\']) ,\'num\':str(int(cart[\'num\'])+1)}))\n\t\t\t\ti+=1\n\t\t\telse:\n\t\t\t\tar_carts.append(str({\'id\':str(cart[\'id\']) ,\'num\':str(cart[\'num\'])}))\n\t\tif i==0:\n\t\t\tnum_carts +=1\n\t\t\tar_carts.append(str({\'id\':pid ,\'num\':str(1)}))\n\telse:\n\t\tar_carts.append(str({\'id\':pid ,\'num\':str(1)}))\n\t\tnum_carts +=1\n\t\t\n\tresponse.cookies[\'cart_shop\'] = str(ar_carts) \n\tresponse.cookies[\'cart_shop\'][\'expires\'] = 24 * 3600\n\tresponse.cookies[\'cart_shop\'][\'path\'] = \'/\'\n\tresponse.flash = T("Add new cart!")\n\t\n\t# load view_carts() nhung ko request duoc cookies moi\n\t\n\tcache.ram.clear(None)\n\tdiv = SPAN(num_carts,_class="badge")\n\tif num_carts !=0:\n\t\treturn div\n\telse: return \'\'\n\t\ndef view_carts():\n\tdiv = DIV()\n\tnum_car = 0\n\ttong_tien = 0\n\tcarts =\'\'\n\ttry:\n\t\tif request.cookies.has_key(\'cart_shop\'):\n\t\t\tcarts = eval(request.cookies[\'cart_shop\'].value)\n\t\t\tfrom plugin_cms import CmsModel\n\t\t\tfrom plugin_cms import CmsFolder\n\t\t\tcms = CmsModel()\n\t\t\tdb = cms.db\n\t\t\tcms.define_table(\'san_pham\')\n\t\t\tfrom plugin_app import number_format\n\t\t\t\n\t\t\tfor cart in carts:\n\t\t\t\tcart = eval(cart)\n\t\t\t\t# row  = db((db.san_pham.id==cart[\'id\'])&(db.san_pham.r_folder== CmsFolder().get_folder(request.args(0)))).select().first()\n\t\t\t\trow  = db((db.san_pham.id==cart[\'id\'])).select().first()\n\t\t\t\tif row:\n\t\t\t\t\tdiv1 = DIV(_class=\'list_cart\')\n\t\t\t\t\tul = UL()\n\t\t\t\t\tul.append(LI(row.name))\n\t\t\t\t\tul.append(LI(SPAN(\'S\xe1\xbb\x91 l\xc6\xb0\xe1\xbb\xa3ng: \'),cart[\'num\']))\n\t\t\t\t\tul.append(LI(SPAN(\'Gi\xc3\xa1: \'),number_format(row.gia_san_pham),\' VN\xc4\x90\'))\n\t\t\t\t\tdiv1.append(DIV(cms.get_images_content(\'san_pham\',row.avatar),_class=\'col-md-4 box_ivinh\'))\n\t\t\t\t\tdiv1.append(DIV(ul,_class=\'col-md-8 box_ivinh\'))\n\t\t\t\t\t\n\t\t\t\t\tdiv.append(div1)\n\t\t\t\t\tdiv.append(HR())\n\t\t\t\t\ttong_tien += int(row.gia_san_pham)* int(cart[\'num\'])\n\t\t\t\t\tnum_car +=1\n\t\tif num_car>0:\t\t\t\n\t\t\tp_tong = DIV(SPAN(\'T\xe1\xbb\x95ng ti\xe1\xbb\x81n: \'))\n\t\t\tp_tong.append(str(number_format(tong_tien))+\' VN\xc4\x90\')\n\t\t\tdiv.append(B(p_tong,_class=\'text-right\'))\n\t\t\tdiv.append(A(\'G\xe1\xbb\xadi \xc4\x91\xc6\xa1n h\xc3\xa0ng\',_href=URL(c=\'portal\',f=\'folder\',args=[\'checkout\']),_class=\'btn btn-success\'))\n\t\telse:\n\t\t\tdiv.append(\'Gi\xe1\xbb\x8f h\xc3\xa0ng tr\xe1\xbb\x91ng\')\n\texcept Exception,e: \n\t\treturn e\n\treturn div\n\t\ndef view_order():\n\tdiv = DIV(_id="view_order")\n\tnum_car = 0\n\ttong_tien = 0\n\tcarts =\'\'\n\tif request.cookies.has_key(\'cart_shop\'):\n\t\tcarts = eval(request.cookies[\'cart_shop\'].value)\n\t\tfrom plugin_cms import CmsModel\n\t\tfrom plugin_cms import CmsFolder\n\t\tcms = CmsModel()\n\t\tdb = cms.db\n\t\tcms.define_table(\'san_pham\')\n\t\tfrom plugin_app import number_format\n\t\ttable = TABLE(_class=\'table\')\n\t\t\n\t\ttable.append(TR(TH(\'S\xe1\xba\xa3n ph\xe1\xba\xa9m\'),TH(\'S\xe1\xbb\x91 l\xc6\xb0\xe1\xbb\xa3ng\'),TH(\'\'),TH(\'Gi\xc3\xa1\'),TH(B(\'Th\xc3\xa0nh ti\xe1\xbb\x81n\'))))\n        for cart in carts:\n\t\t\tcart = eval(cart)\n\t\t\trow  = db((db.san_pham.id==cart[\'id\'])&(db.san_pham.folder== CmsFolder().get_folder(request.args(0)))).select().first()\n\t\t\tif row:\n\t\t\t\ttong_tien += int(row.gia_san_pham)* int(cart[\'num\'])\n\t\t\t\tinput_num = INPUT(_type=\'text\',_value=cart[\'num\'])\n\t\t\t\ttable.append(TR(TD(row.name,\': \'),TD(input_num),TD(\' * \'),TD(number_format(row.gia_san_pham),\' VN\xc4\x90\'),TD(B(number_format(tong_tien),\' VN\xc4\x90\'))))\n\t\t\t\tdiv.append(table)\n\t\t\t\tnum_car +=1\n\tp_tong = DIV(SPAN(\'T\xe1\xbb\x95ng ti\xe1\xbb\x81n: \'))\n\tp_tong.append(str(number_format(tong_tien))+\' VN\xc4\x90\')\n\tdiv.append(B(p_tong,_class=\'text-right\'))\n\t\n\tform = FORM()\n\tdiv1 = DIV(_class="form-group")\n\tdiv1.append(LABEL(\'H\xe1\xbb\x8d v\xc3\xa0 t\xc3\xaan\'))\n\tdiv1.append(INPUT(_type=\'text\',_class="form-control",_placeholder="H\xe1\xbb\x8d v\xc3\xa0 t\xc3\xaan" ))\n\tform.append(div1)\n\t\n\tdiv1 = DIV(_class="form-group")\n\tdiv1.append(LABEL(\'Email\'))\n\tdiv1.append(INPUT(_type=\'text\',_class="form-control",_placeholder="Email"))\n\tform.append(div1)\n\t\n\tdiv1 = DIV(_class="form-group")\n\tdiv1.append(LABEL(\'\xc4\x90i\xe1\xbb\x87n tho\xe1\xba\xa1i\'))\n\tdiv1.append(INPUT(_type=\'text\',_class="form-control",_placeholder="\xc4\x90i\xe1\xbb\x87n tho\xe1\xba\xa1i"))\n\tform.append(div1)\n\t\n\tdiv1 = DIV(_class="form-group")\n\tdiv1.append(LABEL(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 nh\xe1\xba\xadn h\xc3\xa0ng\'))\n\tdiv1.append(INPUT(_type=\'text\',_class="form-control",_placeholder="\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 nh\xe1\xba\xadn h\xc3\xa0ng"))\n\tform.append(div1)\n\t\n\tdiv1 = DIV(_class="form-group")\n\tdiv1.append(LABEL(\'L\xe1\xbb\x9di nh\xe1\xba\xafn\'))\n\tdiv1.append(TEXTAREA(_class="form-control",_rows="3",_placeholder="L\xe1\xbb\x9di nh\xe1\xba\xafn"))\n\tform.append(div1)\n\t\n\tdiv1 = DIV(_class="form-group")\n\tdiv1.append(LABEL(\'L\xe1\xbb\x9di nh\xe1\xba\xafn\'))\n\tdiv1.append(TEXTAREA(_class="form-control",_rows="3",_placeholder="L\xe1\xbb\x9di nh\xe1\xba\xafn"))\n\tform.append(div1)\n\t\n\tajax = "ajax(\'%s\', [], \'order_view\')"%(URL(f=\'act_add_cart\',args=request.args))\n\tform.append(A(\'G\xe1\xbb\xadi \xc4\x91\xe1\xba\xb7t h\xc3\xa0ng\',_onclick=ajax, _class=\'btn btn-success\'))\n\tdiv.append(form)\n\treturn div\n\n\n\t\ndef act_add_cart():\n\tresponse.cookies[\'cart_shop\'] = \'invalid\' \n\tresponse.cookies[\'cart_shop\'][\'expires\'] = -10 \n\tresponse.cookies[\'cart_shop\'][\'path\'] = \'/\' \n\tdiv = DIV(B(\'\xc4\x90\xe1\xba\xb7t h\xc3\xa0ng th\xc3\xa0nh c\xc3\xb4ng. Ch\xc3\xbang t\xc3\xb4i s\xe1\xba\xbd li\xc3\xaan h\xe1\xbb\x87 v\xe1\xbb\x9bi b\xe1\xba\xa1n trong th\xe1\xbb\x9di gian s\xe1\xbb\x9bm nh\xe1\xba\xa5t \xc4\x91\xe1\xbb\x83 x\xc3\xa1c nh\xe1\xba\xadn \xc4\x91\xc6\xa1n h\xc3\xa0ng. Xin c\xe1\xba\xa3m \xc6\xa1n! \'),_class=\'bg-info text-center\' )\n\tdiv.append(DIV(BR(),\'Chuy\xe1\xbb\x83n h\xc6\xb0\xe1\xbb\x9bng v\xe1\xbb\x81 trang ch\xe1\xbb\xa7 sau 3 gi\xc3\xa2y.\',_class=\'bg-info text-center\' ))\n\tscr =\'\'\'\n\t <META http-equiv="refresh" content="3;URL=%s">\n\t\'\'\'%(URL(c=\'portal\',f=\'folder\',args=request.args(0)))\n\tdiv.append(XML(scr))\n\t\n\treturn div\n\t\ndef style_list():\n\tresponse.cookies[\'style_id_sgd\'] =  request.args(0)\n\tresponse.cookies[\'style_id_sgd\'][\'expires\'] = 24 * 3600\n\tresponse.cookies[\'style_id_sgd\'][\'path\'] = \'/\'\n\tresponse.flash = T("\xc4\x90\xe1\xbb\x95i giao di\xe1\xbb\x87n th\xc3\xa0nh c\xc3\xb4ng!")\n\treturn \'\'\n\t\ndef style_layout():\n\tstyle_layout =  request.args(0)\n\tif request.args(0)==\'layout-boxed\':\n\t\tstyle_layout +=\' container\' \n\tresponse.cookies[\'style_layout\'] =  style_layout\n\tresponse.cookies[\'style_layout\'][\'expires\'] = 24 * 3600\n\tresponse.cookies[\'style_layout\'][\'path\'] = \'/\'\n\tresponse.flash = T("\xc4\x90\xe1\xbb\x95i b\xe1\xbb\x91 c\xe1\xbb\xa5c th\xc3\xa0nh c\xc3\xb4ng!")\n\treturn \'\'\n\t\n\ndef add_gian_hang():\n\tprint request.vars.ten_gian_hang\n\tprint request.vars.template\n\treturn \'Th\xc3\xaam th\xc3\xa0nh c\xc3\xb4ng\'\n\t\ndef tao_tin_tim_mua():\n\tfrom plugin_ckeditor import CKEditor\n\ttable = cms.define_table(\'tintuc\')\n\tfor field in table.fields:\n\t\tif field == \'htmlcontent\':\n\t\t\ttable[field].label = \'N\xe1\xbb\x99i dung t\xc3\xacm mua\'\n\t\tif field == \'folder\':\n\t\t\ttable[field].default = 248\n\t\t\ttable[field].readable=False\n\t\t\ttable[field].writable=False\n\t\trow = db(db.dfield.name==field).select().first()\n\t\tif row:\n\t\t\tif row.ckeditor: table[field].widget=CKEditor(db).widget\t\t\n\tform=SQLFORM(table)\n\tif form.process().accepted:\n\t\tfrom plugin_process import ProcessModel\n\t\tobjects = ProcessModel().define_objects()\n\t\tobjects_id = objects.insert(folder=248,foldername=\'san-pham-tim-mua\',tablename=\'tintuc\',table_id=form.vars.id,auth_group=7,process=1)\n\n\t\t# link = form.vars.name.replace(\'\xc4\x91\',\'d\')\n\t\t# link = \'%s.html\'%IS_SLUG.urlify(link)\n\t\t# dcontent = cms.define_dcontent()\n\t\t# dcontent.insert(folder=248,dtable=\'tintuc\',table_id=form.vars.id,link=link,name=form.vars.name,avatar=form.vars.avatar,description=form.vars.description,publish_on=request.now,expired_on=None)\t\n\t\t# cms.db(tin_tuc_edit.id==form.vars.id).update(link=link)\n\t\tsession.flash = T(\'G\xe1\xbb\xadi th\xc3\xb4ng tin t\xc3\xacm mua th\xc3\xa0nh c\xc3\xb4ng\')\n\t\tredirect(URL(c=\'portal\',f=\'folder\',args=[\'san-pham-tim-mua\']))\n\tresponse.view = \'layout/home_dang_tin-tim-mua.html\'\t\n\treturn dict(content=form)\t\t\n\t\n\nresponse._vars=response._caller(search)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "C:\\www-sgd114\\gluon\\restricted.py", line 227, in restricted\n    exec ccode in environment\n  File "C:\\www-sgd114\\applications\\sgd\\controllers/portal.py", line 537, in <module>\n  File "C:\\www-sgd114\\gluon\\globals.py", line 412, in <lambda>\n    self._caller = lambda f: f()\n  File "C:\\www-sgd114\\applications\\sgd\\controllers/portal.py", line 74, in search\n    code = \'<span style=" background: yellow;">\'+request.vars.key_search+\'</span>\'\nTypeError: cannot concatenate \'str\' and \'NoneType\' objects\n'
p11
s.