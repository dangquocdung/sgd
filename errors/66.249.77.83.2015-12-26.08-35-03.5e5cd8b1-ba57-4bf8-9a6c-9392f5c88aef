(dp1
S'output'
p2
S"<type 'exceptions.KeyError'> 'cart_shop'"
p3
sS'layer'
p4
S'C:\\www-sgd114\\applications\\sgd\\controllers/plugin_sgd.py'
p5
sS'code'
p6
S'###################################################\n# This file was developed by Anhnt\n# It is released under BSD, MIT and GPL2 licenses\n# Version 0.1 Date: 28/07/2014\n###################################################\n\ndef add_gian_hang():\n\ttemplate =\'gian_hang.html\'\n\tif request.vars.template:\n\t\tif request.vars.template==\'t1\':\n\t\t\ttemplate =\'gian_hang1.html\'\n\t\telif request.vars.template==\'t2\':\n\t\t\ttemplate =\'gian_hang.html\'\n\t\telse:\n\t\t\ttemplate =\'gian_hang2.html\'\n\tname = request.vars.ten_url.lower()\n\tfolder = cms.define_folder()\n\tid = db.folder.insert(parent=241,name=name,label=request.vars.ten_gian_hang,setting="{\'TABLES\':[\'tintuc\',\'cong_ty\',\'san_pham\']}",layout=template,created_by=auth.user_id)\n\tfrom plugin_process import ProcessModel\n\tprocessmodel = ProcessModel()\n\trole = \'gian-hang-\'+str(name)\n\tgroup_id = processmodel.db.auth_group.insert(role=role,parent=8,atype=\'org\',created_by=1)\n\tprocessmodel.db.auth_permission.insert(group_id =group_id,name=\'quan_tri_gian_hang\',table_name=\'folder\',record_id=id)\n\tprocessmodel.db.auth_membership.insert(group_id =group_id,user_id=auth.user_id)\n\t\n\tauth_name = processmodel.db.auth_user[auth.user_id]\n\t\n\tmail = auth.setting_mail()\n\tmail.send(to=[\'nguyentuananh.aptech@gmail.com\'],subject=\'C\xc3\xb3 1 gian h\xc3\xa0ng m\xe1\xbb\x9bi: %s\'%(request.vars.ten_gian_hang),message=\'Gian h\xc3\xa0ng: %s \xc4\x91\xc3\xa3 \xc4\x91\xc6\xb0\xe1\xbb\xa3c kh\xe1\xbb\x9fi t\xe1\xba\xa1o b\xe1\xbb\x9fi ng\xc6\xb0\xe1\xbb\x9di d\xc3\xb9ng %s\'%(request.vars.ten_gian_hang,(auth_name.first_name +\' \' +auth_name.last_name) )) \n\tmail.send(to=[auth_name.email],subject=\'B\xe1\xba\xa1n \xc4\x91\xc3\xa3 kh\xe1\xbb\x9fi t\xe1\xba\xa1o th\xc3\xa0nh c\xc3\xb4ng gian h\xc3\xa0ng: %s\'%(request.vars.ten_gian_hang),message=\'Gian h\xc3\xa0ng: %s. B\xe1\xba\xa1n vui l\xc3\xb2ng li\xc3\xaan h\xe1\xbb\x87 ban qu\xe1\xba\xa3n tr\xe1\xbb\x8b \xc4\x91\xe1\xbb\x83 \xc4\x91\xc4\x83ng k\xc3\xbd duy\xe1\xbb\x87t gian h\xc3\xa0ng c\xe1\xbb\xa7a b\xe1\xba\xa1n. Xin c\xe1\xba\xa3m \xc6\xa1n\'%(request.vars.ten_gian_hang )) \n\t\n\t\n\t\n\tredirect(URL(c=\'portal\',f=\'folder\',args=[\'tao-nha-cung-cap\',id,name]))\n\t\n\t\ndef add_cong_ty():\n\tid_folder = request.args(1)\n\tname = request.args(2)\n\tfrom plugin_ckeditor import CKEditor\n\tdiv = DIV(_class=\'col-md-12\')\n\tdiv.append(H2(SPAN(\'Kh\xe1\xbb\x9fi t\xe1\xba\xa1o gian h\xc3\xa0ng\',_class=\'title_name\'),_class=\'title_page\'))\n\tcong_ty = cms.define_table(\'cong_ty\')\n\tfrom gluon.tools import Crud\n\tcrud = Crud(cms.db)\n\tcong_ty.folder.default=id_folder\n\tcong_ty.folder.writable=False\n\tcong_ty.folder.readable=False\n\t\n\tcong_ty.start_time.writable=False\n\tcong_ty.start_time.readable=False\n\t\n\tcong_ty.danh_gia.writable=False\n\tcong_ty.danh_gia.readable=False\n\t\n\tcong_ty.is_maps.writable=False\n\tcong_ty.is_maps.readable=False\n\tform = crud.create(cong_ty)\n\tif form.process().accepted:\n\t\tfrom plugin_process import ProcessModel\n\t\tobjects = ProcessModel().define_objects()\n\t\tobjects_id = objects.insert(folder=id_folder,foldername=name,tablename=\'cong_ty\',table_id=form.vars.id,auth_group=8,process=3)\n\t\tlink = name.replace(\'\xc4\x91\',\'d\')\n\t\tlink = \'%s.html\'%IS_SLUG.urlify(link)\n\t\tdcontent = cms.define_dcontent()\n\t\tdcontent.insert(folder=id_folder,dtable=\'cong_ty\',table_id=form.vars.id,link=link,name=form.vars.name,avatar=form.vars.avatar,description=form.vars.description,publish_on=request.now,expired_on=None)\t\n\t\tcms.db(cong_ty.id==form.vars.id).update(link=link)\n\t\tredirect(URL(c=\'portal\',f=\'folder\',args=[name]))\n\tdiv.append(form)\n\tresponse.view = \'layout/home_dang_ky_nha_cung_cap.html\'\n\treturn dict(content=div)\n\t\ndef edit_cong_ty():\n\tid_folder = request.args(1)\n\tname = request.args(0)\n\n\tfrom plugin_ckeditor import CKEditor\n\tdiv = DIV(_class=\'col-md-12\')\n\tdiv.append(H2(SPAN(\'Kh\xe1\xbb\x9fi t\xe1\xba\xa1o gian h\xc3\xa0ng\',_class=\'title_name\'),_class=\'title_page\'))\n\n\tcong_ty = cms.define_table(\'cong_ty\')\n\tcong_ty_id = db(cong_ty.folder==folder_id_gian_hang).select().first()\n\tfrom gluon.tools import Crud\n\tcrud = Crud(cms.db)\n\tcong_ty.folder.default=id_folder\n\tcong_ty.folder.writable=False\n\tcong_ty.folder.readable=False\n\n\tcong_ty.start_time.writable=False\n\tcong_ty.start_time.readable=False\n\n\tcong_ty.danh_gia.writable=False\n\tcong_ty.danh_gia.readable=False\n\n\tcong_ty.is_maps.writable=False\n\tcong_ty.is_maps.readable=False\n\tform = crud.update(cong_ty,cong_ty_id)\n\tif form.process().accepted:\n\n\t\tfrom plugin_process import ProcessModel\n\t\tobjects = ProcessModel().define_objects()\n\t\tobjects_id = objects.insert(folder=id_folder,foldername=name,tablename=\'cong_ty\',table_id=form.vars.id,auth_group=8,process=3)\n\t\t\n\t\tlink = name.replace(\'\xc4\x91\',\'d\')\n\t\tlink = \'%s.html\'%IS_SLUG.urlify(link)\n\t\tdcontent = cms.define_dcontent()\n\t\tdcontent.insert(folder=id_folder,dtable=\'cong_ty\',table_id=form.vars.id,link=link,name=form.vars.name,avatar=form.vars.avatar,description=form.vars.description,publish_on=request.now,expired_on=None)\t\n\t\tcms.db(cong_ty.id==form.vars.id).update(link=link)\n\t\tredirect(URL(c=\'portal\',f=\'folder\',args=[name]))\n\tpass\n\tdiv.append(form)\n\t\ndef act_add_cart():\n\tdon_hang = cms.define_table(\'don_hang\')\n\tdon_hang_item = cms.define_table(\'don_hang_item\')\n\tdon_hang_item = cms.define_table(\'san_pham\')\n\tdon_hang_gian_hang = cms.define_table(\'don_hang_gian_hang\')\n\tgian_hang = []\n\tfrom plugin_cms import CmsFolder\n\tfolder_id = CmsFolder().get_folder(request.args(0))\n\t\n\tdon_hang_id = db.don_hang.insert(auth_user = auth.user_id or \'\',nguoi_nhan_hang=request.vars.ho_ten,email=request.vars.email,dien_thoai=request.vars.dien_thoai,dia_chi=request.vars.dia_chi,loi_nhan=request.vars.loi_nhan,thanh_toan=request.vars.pttt )\n\tcarts = eval(request.cookies[\'cart_shop\'].value)\n\t\n\tfor cart in carts:\n\t\tcart = eval(cart)\n\t\trow  = db(db.san_pham.id==cart[\'id\']).select().first()\n\t\tif row:\n\t\t\tif row.r_folder not in gian_hang:\n\t\t\t\tgian_hang.append(row.r_folder)\n\t\t\tdb.don_hang_item.insert(r_don_hang=don_hang_id,r_san_pham=cart[\'id\'],so_luong=cart[\'num\'],gia_ban=row.gia_san_pham)\n\tif len(gian_hang)>0:\n\t\tfor g in gian_hang:\n\t\t\tdb.don_hang_gian_hang.insert(folder_gian_hang=g,r_status=1,r_don_hang=don_hang_id)\n\tresponse.cookies[\'cart_shop\'] = \'invalid\' \n\tresponse.cookies[\'cart_shop\'][\'expires\'] = -10 \n\tresponse.cookies[\'cart_shop\'][\'path\'] = \'/\' \n\tdiv = DIV(B(\'\xc4\x90\xe1\xba\xb7t h\xc3\xa0ng th\xc3\xa0nh c\xc3\xb4ng. Ch\xc3\xbang t\xc3\xb4i s\xe1\xba\xbd li\xc3\xaan h\xe1\xbb\x87 v\xe1\xbb\x9bi b\xe1\xba\xa1n trong th\xe1\xbb\x9di gian s\xe1\xbb\x9bm nh\xe1\xba\xa5t \xc4\x91\xe1\xbb\x83 x\xc3\xa1c nh\xe1\xba\xadn \xc4\x91\xc6\xa1n h\xc3\xa0ng. Xin c\xe1\xba\xa3m \xc6\xa1n! \'),_class=\'bg-info text-center\' )\n\tdiv.append(DIV(BR(),\'Chuy\xe1\xbb\x83n h\xc6\xb0\xe1\xbb\x9bng v\xe1\xbb\x81 trang ch\xe1\xbb\xa7 sau 3 gi\xc3\xa2y.\',_class=\'bg-info text-center\' ))\n\tscr =\'\'\'\n\t <META http-equiv="refresh" content="3;URL=%s">\n\t\'\'\'%(URL(c=\'portal\',f=\'folder\',args=[\'home\']))\n\tdiv.append(XML(scr))\n\treturn div\n\t\ndef test_email():\n\tmail = auth.setting_mail()\n\tresponse.view = \'plugin_sgd/content.%s\'%request.extension\n\tif mail.send(to=[\'nguyentuananh.aptech@gmail.com\'],subject=\'Ti\xc3\xaau \xc4\x91\xe1\xbb\x81 email\',message=\'Tin ki\xe1\xbb\x83m tra\'):\n\t\tabc =\'Ok\'\n\telse: abc =\'NO\'\n\treturn dict(content=abc)\n\t\ndef view_don_hang():\n\tfrom plugin_app import number_format\n\tdon_hang_id = request.args(1)\n\tdon_hang = cms.define_table(\'don_hang\')\n\tdon_hang_item = cms.define_table(\'don_hang_item\')\n\tsan_pham = cms.define_table(\'san_pham\')\n\trows_don_hang = cms.db.don_hang[don_hang_id]\n\tquery = (don_hang_item.r_don_hang==don_hang_id)\n\trows_don_hang_item = cms.db(query).select()\n\tdiv = DIV()\n\ttable = TABLE(_class=\'table\')\n\ttable.append(TR(TH(\'Kh\xc3\xa1ch h\xc3\xa0ng\'),TD(rows_don_hang.nguoi_nhan_hang)))\n\ttable.append(TR(TH(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 nh\xe1\xba\xadn h\xc3\xa0ng\'),TD(rows_don_hang.dia_chi)))\n\ttable.append(TR(TH(\'L\xe1\xbb\x9di nh\xe1\xba\xafn:\'),TD(rows_don_hang.loi_nhan)))\n\tdiv.append(table)\n\tdiv.append(H4(\'Chi ti\xe1\xba\xbft \xc4\x91\xc6\xa1n h\xc3\xa0ng\'))\n\ttable = TABLE(_class=\'table\')\n\ttable.append(TR(TH(\'Stt\',_style="width: 30px;"),TH(\'T\xc3\xaan s\xe1\xba\xa3n ph\xe1\xba\xa9m\'),TH(\'S\xe1\xbb\x91 l\xc6\xb0\xe1\xbb\xa3ng\'),TH(\'\xc4\x90\xc6\xa1n gi\xc3\xa1\'),TH(\'Th\xc3\xa0nh ti\xe1\xbb\x81n\')))\n\ti = 1\n\tfor row in rows_don_hang_item:\n\t\tif row.r_san_pham.r_folder ==int(request.args(0)):\n\t\t\ttable.append(TR(TD(i,_class=\'text-center\'),TD(row.r_san_pham.name),TD(row.so_luong),TD(number_format(row.gia_ban),\' VN\xc4\x90\'),TD(number_format(int(row.gia_ban)* int(row.so_luong)),\' VN\xc4\x90\')))\n\t\t\ti +=1\n\tdiv.append(table)\n\tdiv_bt = DIV(_class="modal-footer")\n\t\n\tdiv_st = DIV(_class="btn-group")\n\tdiv_st.append(BUTTON(T(\'C\xe1\xba\xadp nh\xe1\xba\xadt tr\xe1\xba\xa1ng th\xc3\xa1i\'),_type="button" ,_class="btn btn-default dropdown-toggle" ,**{ "_data-toggle":"dropdown" ,"_aria-expanded":"false"}))\n\t\n\tdon_hang_status = cms.define_table(\'don_hang_status\')\n\trow_status = cms.db(don_hang_status.id>0).select()\n\tul_st = UL(_class="dropdown-menu")\n\tfor s in row_status:\n\t\t# ajax = "ajax(\'%s\', [], \'\')"%(URL(f=\'update_don_hang\',args=request.args,vars=dict(\'status\'=s.id)))\n\t\tul_st.append(LI(A(s.name,_class="btn btn-default")))\n\tdiv_st.append((ul_st))\n\t# div_bt.append((div_st))\n\t# div_bt.append(A(\'X\xc3\xb3a \xc4\x91\xc6\xa1n h\xc3\xa0ng\',_class="btn btn-default"))\n\tdiv_bt.append(A(\'G\xe1\xbb\xadi ph\xe1\xba\xa3n h\xe1\xbb\x93i\',_href="mailto:%s?Subject=Xin ch\xc3\xa0o kh\xc3\xa1ch h\xc3\xa0ng %s"%(rows_don_hang.email,rows_don_hang.nguoi_nhan_hang), _class="btn btn-primary" ))\n\tdiv_bt.append(A(\'Tho\xc3\xa1t\',_class="btn btn-default",**{"_data-dismiss":"modal"}))\n\tdiv.append(div_bt)\n\treturn div\n\t\ndef update_don_hang():\n\ttry:\n\t\tdon_hang_gian_hang = cms.define_table(\'don_hang_gian_hang\')\n\t\tstatus = request.vars[request.vars.name]\n\t\tid = cms.db((don_hang_gian_hang.folder_gian_hang==request.vars.folder)&(don_hang_gian_hang.r_don_hang==request.vars.don_hang)).update(r_status=status)\n\t\tif not id:\n\t\t\tcms.db.don_hang_gian_hang.insert(folder_gian_hang==request.vars.folder,r_don_hang==request.vars.don_hang,r_status=status)\n\t\tsession.flash = T("C\xe1\xba\xadp nh\xe1\xba\xadt th\xc3\xa0nh c\xc3\xb4ng!")\n\t\treturn \'\'\n\texcept Exception,e: \n\t\tprint  e\n\t\ndef index():\n\treturn dict()\n\n# START QUAN TRI GIAN HANG\n\t\n\n@auth.requires(auth.has_membership(role=\'admin\') or auth.has_membership(role=\'ql_gian_hang\'))\t\ndef gian_hang():\n\tdiv = DIV(_id=\'gian_hang\')\n\twr_toolbar = DIV(_id=\'toolbar_gian_hang\')\n\t\n\ttoolbar = DIV(_class="btn-group pull-left")\n\tajax = "ajax(\'%s\', [], \'wr_view_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'cread_gian_hang\'))\n\ttoolbar.append(A(SPAN(_class=\'glyphicon glyphicon-plus\'),\'Th\xc3\xaam gian h\xc3\xa0ng\',_class="btn btn-primary",**{\'_data-toggle\':\'modal\',\'_data-target\':\'#act_add_gian_hang\'}))\n\twr_toolbar.append(toolbar)\n\t\n\t\n\t# toolbar = DIV(_class="btn-group pull-right")\n\t# toolbar.append(A(\'T\xe1\xba\xa5t c\xe1\xba\xa3 l\xc4\xa9nh v\xe1\xbb\xb1c\',_class="btn btn-primary"))\n\t# toolbar.append(A(SPAN(_class=\'caret\'),SPAN(_class=\'sr-only\'),_class="btn btn btn-primary dropdown-toggle",**{\'_data-toggle\':"dropdown", \'_aria-expanded\':"false"}))\n\t# ul =UL(_class="dropdown-menu")\n\t# ul.append(LI(A(\'\xc4\x90i\xe1\xbb\x87n tho\xe1\xba\xa1i\')))\n\t# ul.append(LI(A(\'M\xc3\xa1y t\xc3\xadnh\')))\n\t# toolbar.append(ul)\n\t# wr_toolbar.append(toolbar)\n\t\n\t\n\ttoolbar = DIV(_class="btn-group pull-right ")\n\tajax = "ajax(\'%s\', [], \'wr_view_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'view_gian_hang\'))\n\ttoolbar.append(A(\'T\xe1\xba\xa5t c\xe1\xba\xa3 gian h\xc3\xa0ng\',_class="btn btn-primary",_onclick=ajax))\n\ttoolbar.append(A(SPAN(_class=\'caret\'),SPAN(_class=\'sr-only\'),_class="btn btn btn-primary dropdown-toggle",**{\'_data-toggle\':"dropdown", \'_aria-expanded\':"false"}))\n\tul =UL(_class="dropdown-menu")\n\tajax = "ajax(\'%s\', [], \'wr_view_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'view_gian_hang\',vars=dict(type_gian_hang=240)))\n\tul.append(LI(A(\'Gian h\xc3\xa0ng \xc4\x91\xc3\xa3 c\xe1\xba\xa5p ph\xc3\xa9p\',_onclick=ajax)))\n\tajax = "ajax(\'%s\', [], \'wr_view_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'view_gian_hang\',vars=dict(type_gian_hang=241)))\n\tul.append(LI(A(\'Gian h\xc3\xa0ng ch\xe1\xbb\x9d c\xe1\xba\xa5p ph\xc3\xa9p\',_onclick=ajax)))\n\ttoolbar.append(ul)\n\twr_toolbar.append(toolbar)\n\t\n\tajax = "ajax(\'%s\', [\'serch_key\'], \'wr_view_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'view_gian_hang\'))\n\ttoolbar = INPUT(_type=\'text\',_class=\'form-control serch_by_name  pull-right\',_name=\'serch_key\',_onkeydown=ajax,_placeholder=\'T\xc3\xacm theo t\xc3\xaan gian h\xc3\xa0ng\')\n\twr_toolbar.append(toolbar)\n\t\n\tdiv.append(wr_toolbar)\n\tdiv.append(DIV(view_gian_hang(),_id=\'wr_view_gian_hang\'))\n\treturn dict(content=div)\n\t\ndef cread_gian_hang():\n\treturn dict()\n\t\ndef add_gian_hang_admin():\n\ttemplate =\'gian_hang.html\'\n\tif request.vars.template:\n\t\tif request.vars.template==\'t1\':\n\t\t\ttemplate =\'gian_hang1.html\'\n\t\telif request.vars.template==\'t2\':\n\t\t\ttemplate =\'gian_hang.html\'\n\t\telse:\n\t\t\ttemplate =\'gian_hang2.html\'\n\tname = request.vars.ten_gian_hang\n\tname = name.replace(\'\xc4\x91\',\'d\')\n\tname = \'%s\'%IS_SLUG.urlify(name)\n\tfolder = cms.define_folder()\n\tid = db.folder.insert(parent=241,name=name,label=request.vars.ten_gian_hang,setting="{\'TABLES\':[\'tintuc\',\'cong_ty\',\'san_pham\']}",layout=template,created_by=auth.user_id)\n\ttry:\n\t\tfrom plugin_process import ProcessModel\n\t\tprocessmodel = ProcessModel()\n\t\tif id:\n\t\t\tcong_ty = cms.define_table(\'cong_ty\')\n\t\t\tlink = (request.vars.ten_gian_hang).replace(\'\xc4\x91\',\'d\')\n\t\t\tlink = \'%s.html\'%IS_SLUG.urlify(link)\n\t\t\tct_id = db.cong_ty.insert(name=request.vars.ten_gian_hang,link=link,folder=id)\n\t\t\tif ct_id:\n\t\t\t\tobjects = processmodel.define_objects()\n\t\t\t\tobjects_id = objects.insert(folder=id,foldername=name,tablename=\'cong_ty\',table_id=ct_id,auth_group=8,process=3)\n\t\t\t\tdcontent = cms.define_dcontent()\n\t\t\t\tdcontent.insert(folder=id,dtable=\'cong_ty\',table_id=ct_id,link=link,name=request.vars.ten_gian_hang,publish_on=request.now,expired_on=None)\t\n\texcept Exception,e: \n\t\treturn e\n\trole = \'gian-hang-\'+str(name)\n\tgroup_id = processmodel.db.auth_group.insert(role=role,parent=8,atype=\'org\',created_by=1)\n\tprocessmodel.db.auth_permission.insert(group_id =group_id,name=\'quan_tri_gian_hang\',table_name=\'folder\',record_id=id)\n\tprocessmodel.db.auth_membership.insert(group_id =group_id,user_id=auth.user_id)\n\tresponse.flash = T(\'Th\xc3\xaam th\xc3\xa0nh c\xc3\xb4ng.\')\n\treturn LOAD(c=\'plugin_sgd\',f=\'detai_gian_hang.load\',args=[id],ajax=False)\n\t\ndef view_gian_hang():\n\tul = UL(_class=\'wr_view_gian_hang\')\n\tfolder = cms.define_folder()\n\tquery = folder.id>0\n\ttype_gian_hang = 292\n\tif request.vars.type_gian_hang:\n\t\tquery &= folder.parent == request.vars.type_gian_hang\n\telse:\t\n\t\tquery &= folder.parent.belongs([240,241])\n\tif request.vars.serch_key:\n\t\tquery &= folder.label.contains(request.vars.serch_key)\n\trows = cms.db(query).select(orderby=~cms.db.folder.created_on)\n\tfor row in rows:\n\t\t\n\t\tli = LI(_class=\'item_gian_hang gian_hang_%s\'%(row.parent.name),**{\'_data-toggle\':\'modal\',\'_data-target\':\'#exampleModal\',\'_data-whatever\':row.id})\n\t\tli.append(DIV(_class=\'image\'))\n\t\tli.append(DIV(SPAN(row.label),_class=\'name\'))\n\t\tul.append(li)\n\treturn ul\n\t\ndef detai_gian_hang():\n\tfolder = cms.define_folder()\n\tfolder_id = request.args(0)\n\trow = folder[folder_id]\n\tdiv = DIV(_id=\'detai_gian_hang\')\n\tdiv_header = DIV(_class=\'modal-header\')\n\tdiv_header.append(A(SPAN(XML(\'&times;\'),**{\'_aria-hidden\':\'true\'}),_class="close",**{ \'_data-dismiss\':\'modal\', \'_aria-label\':\'Close\'}))\n\tdiv_header.append(H4(row.parent.label,\' : \',row.label,_class="modal-title", _id="exampleModalLabel"))\n\tdiv.append(div_header)\n\t\n\t\n\tdiv_body = DIV(_class=\'modal-body\')\n\twr_toolbar = DIV(_class="wr_toolbar text-left")\n\t\n\tif (row.parent==241):\n\t\tajax = "ajax(\'%s\', [], \'detai_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'act_move_folder\',args=[folder_id],vars=dict(parent=240,folder=row.id)))\n\t\ttoolbar = DIV(_class="btn-group ")\n\t\ttoolbar.append(A(\'Duy\xe1\xbb\x87t gian h\xc3\xa0ng\',_onclick=ajax,_class="btn btn-danger"))\n\t\twr_toolbar.append(toolbar)\n\telif (row.parent==240):\n\t\tajax = "ajax(\'%s\', [], \'detai_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'act_move_folder\',args=[folder_id],vars=dict(parent=241,folder=row.id)))\n\t\ttoolbar = DIV(_class="btn-group ")\n\t\ttoolbar.append(A(\'G\xe1\xbb\xa1 gian h\xc3\xa0ng\',_onclick=ajax,_class="btn btn-danger"))\n\t\twr_toolbar.append(toolbar)\n\t\t\n\ttoolbar = DIV(_class="btn-group ")\n\tajax = "ajax(\'%s\', [], \'detai_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'act_delete_folder\',args=[folder_id]))\n\ttoolbar.append(A(\'X\xc3\xb3a\',_onclick=ajax,_class="btn btn-danger"))\n\twr_toolbar.append(toolbar)\n\tcong_ty = cms.define_table(\'cong_ty\')\n\trows = cms.db(cong_ty.folder==row.id).select()\n\tdanh_gia = 0\n\tif rows:\n\t\tif rows[0].danh_gia:\n\t\t\tdanh_gia = rows[0].danh_gia\n\ttoolbar = DIV(_class=" pull-right ")\n\tfor i in [0,1,2,3,4,5]:\n\t\tajax = "ajax(\'%s\', [\'\',\'\'], \'wr_alert\')"%(URL(c=\'plugin_sgd\',f=\'update_xep_hang\',args=[rows[0].id,i]))\n\t\tif i == danh_gia:\n\t\t\ttoolbar.append(A(i,_onclick=ajax,_class=\'active vote_item vote_item_%s\'%(i)))\n\t\telse:\n\t\t\ttoolbar.append(A(i,_onclick=ajax,_class=\'vote_item vote_item_%s\'%(i)))\n\t# ajax = "ajax(\'%s\', [\'\',\'\'], \'\')"%(URL(c=\'plugin_sgd\',f=\'update_xep_hang\',args=[rows[0].id,0]))\n\t# toolbar.append(A(\'1\',_onclick=ajax,_class=\'vote_item vote_item_1\'))\n\t# toolbar.append(A(\'2\',_href=\'\',_class=\'vote_item vote_item_2\'))\n\t# toolbar.append(A(\'3\',_href=\'\',_class=\'vote_item vote_item_3\'))\n\t# toolbar.append(A(\'4\',_href=\'\',_class=\'vote_item vote_item_4\'))\n\t# toolbar.append(A(\'5\',_href=\'\',_class=\'vote_item vote_item_5\'))\n\t\n\ttoolbar.append(DIV(_id=\'wr_alert\'))\n\twr_toolbar.append(toolbar)\n\tdiv_body.append(wr_toolbar)\n\t\n\tul_na = UL(_class=\'nav nav-tabs\',**{\'_role\':\'tablist\'})\n\t\n\t# ul_na.append(LI(A(\'Th\xc3\xb4ng tin chi ti\xe1\xba\xbft\',_href="#tab1",**{\'_aria-controls\':\'tab1\', \'_role\':\'tab\',\'_data-toggle\':\'tab\'}),_class=\'active\'))\n\t# ul_na.append(LI(A(\'S\xe1\xba\xa3n ph\xe1\xba\xa9m\',_href="#tab2",**{\'_aria-controls\':\'tab2\', \'_role\':\'tab\',\'_data-toggle\':\'tab\'})))\n\t\n\tul_na.append(LI(A(\'Xem tr\xc6\xb0\xe1\xbb\x9bc gian h\xc3\xa0ng\',_href="#tab4",**{\'_aria-controls\':\'tab4\', \'_role\':\'tab\',\'_data-toggle\':\'tab\'}),_class=\'active\'))\n\tul_na.append(LI(A(\'Qu\xe1\xba\xa3n tr\xe1\xbb\x8b ng\xc6\xb0\xe1\xbb\x9di d\xc3\xb9ng\',_href="#tab3",**{\'_aria-controls\':\'tab3\', \'_role\':\'tab\',\'_data-toggle\':\'tab\'})))\n\tul_na.append(LI(A(\'Th\xe1\xbb\x91ng k\xc3\xaa \xc4\x91\xc3\xa1nh gi\xc3\xa1\',_href="#tab5",**{\'_aria-controls\':\'tab5\', \'_role\':\'tab\',\'_data-toggle\':\'tab\'})))\n\tdiv_body.append(ul_na)\n\tdiv_content = DIV(_class="tab-content")\n\tfrom plugin_cong_ty import add_cong_ty\n\t# div_content.append(DIV(\'Th\xc3\xb4ng tin v\xe1\xbb\x81 c\xc3\xb4ng ty\',DIV(_class=\'clearfix\'),_class=\'tab-pane active\',_id=\'tab1\'))\n\t# # div_content.append(DIV(add_cong_ty(folder_id),DIV(_class=\'clearfix\'),_class=\'tab-pane\',_id=\'tab1\'))\n\t# div_content.append(DIV(\'List s\xe1\xba\xa3n ph\xe1\xba\xa9m c\xe1\xbb\xa7a gian h\xc3\xa0ng\',_class=\'tab-pane\',_id=\'tab2\'))\n\t# div_content.append(DIV(\'List b\xc3\xa0i vi\xe1\xba\xbft c\xe1\xbb\xa7a gian h\xc3\xa0ng\',_class=\'tab-pane\',_id=\'tab3\'))\n\tdiv_content.append(DIV(IFRAME(_src=URL(c=\'portal\',f=\'folder\',args=[row.name],vars=dict(page=\'quan-ly-gian-hang\')),_name="mainwindow",_frameborder="no",_style="width: 100%;min-height: 600px;"),_class=\'tab-pane active\',_id=\'tab4\'))\n\tdiv_content.append(DIV(wr_user(row.name),_class=\'tab-pane\',_id=\'tab3\'))\n\tdiv_content.append(DIV(\'B\xc3\xa1o c\xc3\xa1o, th\xe1\xbb\x91ng k\xc3\xaa \xc4\x91\xc3\xa1nh gi\xc3\xa1\',_class=\'tab-pane\',_id=\'tab5\'))\n\tdiv_body.append(div_content)\n\tdiv.append(div_body)\n\tresponse.view = \'plugin_sgd/content.%s\'%request.extension\n\treturn dict(content=div)\n\t\ndef update_xep_hang():\n\tid = request.args(0)\n\tcong_ty = cms.define_table(\'cong_ty\')\n\t# cong_ty[id].update(danh_gia=request.args(1))\n\tcms.db(cong_ty.id==id).update(danh_gia=request.args(1))\n\treturn \'C\xe1\xba\xadp nh\xe1\xba\xadt th\xc3\xa0nh c\xc3\xb4ng\'\n\t\n\ndef wr_user(folder_name):\n\tdiv = DIV(_class=\'row\')\n\tdiv.append(DIV(A(T(\'Th\xc3\xaam ng\xc6\xb0\xe1\xbb\x9di d\xc3\xb9ng\'),_class=\'btn btn-danger\',_href=URL(c=\'plugin_auth\',f=\'users.html\')),_class=\'col-md-12\'))\n\t\n\t\n\tfrom plugin_process import ProcessModel\n\tdb_auth = ProcessModel().db\n\t# rows = db_auth((db_auth.auth_user.auth_group==8)).select()\n\t# if len(rows)>0:\n\t\t# div2 = DIV(H2(T(\'Danh s\xc3\xa1ch kh\xc3\xa1ch h\xc3\xa0ng\')))\n\t\t# table = TABLE(_class=\'table-bordered\')\n\t\t# table.append(TR(TH(\'Stt\',_style=\'with:30px;\'),TH(T(\'H\xe1\xbb\x8d t\xc3\xaan\')),TH(T(\'Email\')),TH(T(\'Ng\xc3\xa0y tham gia\'))))\n\t\t# i = 1\n\t\t# for row in rows:\n\t\t\t# tr = TR()\n\t\t\t# tr.append(TD(i))\n\t\t\t# name = row.last_name +\' \'+row.first_name\n\t\t\t# tr.append(TD(A(name)))\n\t\t\t# tr.append(TD(row.email))\n\t\t\t# tr.append(TD(row.created_on))\n\t\t\t# i+=1\n\t\t\t# table.append(tr)\n\t\t# div2.append(table)\n\t# div.append(DIV(div2,_class=\'col-md-5\'))\n\t# div.append(DIV(A(T(\'Th\xc3\xaam v\xc3\xa0o\'),SPAN(_class=\'glyphicon glyphicon-chevron-right\'),_class=\'btn btn-default\',_href=URL(c=\'plugin_auth\',f=\'users.html\')),_class=\'col-md-2\'))\n\tdiv.append(DIV(list_user(folder_name),_class=\'col-md-12\'))\n\treturn div\n\t\ndef list_user(folder_name):\n\tfrom plugin_process import ProcessModel\n\tdb_auth = ProcessModel().db\n\trows = db_auth((db_auth.auth_membership.group_id==db_auth.auth_group.id)&(db_auth.auth_group.role==\'gian-hang-%s\'%(folder_name))).select()\n\tif len(rows)>0:\n\t\tdiv = DIV(H2(T(\'Danh s\xc3\xa1ch qu\xe1\xba\xa3n tr\xe1\xbb\x8b gian h\xc3\xa0ng\')))\n\t\ttable = TABLE(_class=\'table-bordered\')\n\t\ttable.append(TR(TH(\'Stt\',_style=\'with:30px;\'),TH(T(\'H\xe1\xbb\x8d t\xc3\xaan\')),TH(T(\'Email\')),TH(T(\'Ng\xc3\xa0y tham gia\'))))\n\t\ti = 1\n\t\tfor row in rows:\n\t\t\ttr = TR()\n\t\t\ttr.append(TD(i))\n\t\t\tname = row.auth_membership.user_id.last_name +\' \'+row.auth_membership.user_id.first_name\n\t\t\ttr.append(TD(A(name, _href=URL(c=\'plugin_auth\',f=\'users.html\',args=[row.auth_membership.user_id]))))\n\t\t\ttr.append(TD(row.auth_membership.user_id.email))\n\t\t\ttr.append(TD(row.auth_membership.user_id.created_on))\n\t\t\ti+=1\n\t\t\ttable.append(tr)\n\t\tdiv.append(table)\n\t\treturn div\n\telse:\n\t\treturn T(\'Ch\xc6\xb0a c\xc3\xb3 ng\xc6\xb0\xe1\xbb\x9di d\xc3\xb9ng.\')\n\t\ndef act_move_folder():\n\tid = request.vars.folder\n\tparent = request.vars.parent\n\tdiv = DIV()\n\tif id:\n\t\tfolder = cms.define_folder()\n\t\tcms.db(folder.id==id).update(parent=parent)\n\t\tresponse.flash = T(\'C\xe1\xba\xadp nh\xe1\xba\xadt th\xc3\xa0nh c\xc3\xb4ng\')\n\telse:\n\t\tresponse.flash = T(\'C\xe1\xba\xadp nh\xe1\xba\xadt l\xe1\xbb\x97i.\')\n\treturn detai_gian_hang()\n\t\ndef act_delete_folder():\n\tif request.args(0):\n\t\tfolder = cms.define_folder()\n\t\tfolder_d = cms.db.folder[request.args(0)]\n\t\tname = folder_d.name\n\t\tid = cms.db(cms.db.folder.id== request.args(0)).delete()\n\t\tif id:\n\t\t\tfrom plugin_process import ProcessModel\n\t\t\tprocessmodel = ProcessModel()\n\t\t\trole = \'gian-hang-\'+str(name)\n\t\t\tprocessmodel.db((processmodel.db.auth_permission.record_id==request.args(0))&(processmodel.db.auth_permission.name==\'quan_tri_gian_hang\')&(processmodel.db.auth_permission.table_name==\'folder\')).delete()\n\t\t\tprocessmodel.db(processmodel.db.auth_group.role==role).delete()\n\t\tresponse.flash = T(\'X\xc3\xb3a th\xc3\xa0nh c\xc3\xb4ng.\')\n\tscr =\'\'\'<script type="text/javascript">\n\t\t\t$(\'#exampleModal\').modal(\'hide\')\n\t\t</script>\n\t\t\'\'\'\n\treturn XML(scr)\n# END GIAN HANG\n# START ADS\n\n\ndef ads():\n\treturn dict(content=\'\')\n\t\ndef ads_img():\n\tdiv = DIV(_id=\'gian_hang\',_class=\'panel panel-default\')\n\tdiv.append(DIV(T(\'Qu\xe1\xba\xa3ng c\xc3\xa1o banner\'),_class=\'panel-heading\'))\n\ttable = \'ads_img\'\n\tcms.define_table(table,True)\n\tcontent = SQLFORM.grid(cms.db[table])\n\tdiv.append(DIV(content,_class=\'panel-body\'))\n\tresponse.view = \'plugin_sgd/ads.%s\'%request.extension\n\treturn dict(content=div)\n\t\ndef ads_product():\n\tdiv = DIV(_id=\'ads_product\',_class=\'panel panel-default\')\n\tdiv.append(DIV(T(\'Qu\xe1\xba\xa3ng c\xc3\xa1o s\xe1\xba\xa3n ph\xe1\xba\xa9m\'),_class=\'panel-heading\'))\n\t# content = TABLE(_class=\'table table-hover table-bordered\',_id="view_ads")\n\t# content.append(TR(TH(\'S\xe1\xba\xa3n ph\xe1\xba\xa9m\'),TH(\'Lo\xe1\xba\xa1i qu\xe1\xba\xa3ng c\xc3\xa1o\'),TH(\'Th\xe1\xbb\x9di gian b\xe1\xba\xaft \xc4\x91\xe1\xba\xa7u\'),TH(\'Th\xe1\xbb\x9di gian k\xe1\xba\xbft th\xc3\xbac\'),TH(\'Ng\xc6\xb0\xe1\xbb\x9di \xc4\x91\xe1\xba\xa1i di\xe1\xbb\x87n\')))\n\t# ads_product = cms.define_table(\'ads_product\',True)\n\t# rows = cms.db(ads_product.id>0).select()\n\t# for row in rows:\n\t\t# ul =UL()\n\t\t# for type in row.r_ads_product_type:\n\t\t\t# ul.append(LI(type.name))\n\t\t# product = DIV()\n\t\t# product.append(DIV(cms.get_images_content(\'san_pham\',row.r_product.avatar),_class=\'ads_product_image\'))\n\t\t# product.append(row.r_product.name)\n\t\t# product.append(\'Gian h\xc3\xa0ng: \',A(row.r_product.name,_href=URL(c=\'\',f=\'\')))\n\t\t# content.append(TR(TD(product),TD(ul),TD(row.time_start),TD(row.time_end),TD(row.htmlcontent)))\n\ttable = \'ads_product\'\n\tcms.define_table(table,True)\n\tads_product = cms.db[table]\n\tfrom plugin_app import widget_san_pham\n\tads_product.r_san_pham.widget = widget_san_pham\n\tcontent = SQLFORM.grid(ads_product)\n\tdiv.append(DIV(content,_class=\'panel-body\'))\n\tresponse.view = \'plugin_sgd/ads.%s\'%request.extension\n\treturn dict(content=div)\n\t\ndef edit_box():\n\tdiv = DIV(_id=\'ads_product\',_class=\'panel panel-default\')\n\tdiv.append(DIV(T(\'Qu\xe1\xba\xa3ng c\xc3\xa1o\'),_class=\'panel-heading\'))\n\tbox = cms.define_box()\n\tfrom plugin_ckeditor import CKEditor\n\tbox.htmlcontent.widget=CKEditor(cms.db).widget\t\n\tbox.boxtype.writable=False\n\tbox.boxtype.readable=False\n\t\n\tbox.name.writable=False\n\t\n\tbox.avatar.writable=False\n\tbox.avatar.readable=False\n\t\n\tbox.link.writable=False\n\tbox.link.readable=False\n\t\n\tbox.setting.writable=False\n\tbox.setting.readable=False\n\t\n\tbox.textcontent.writable=False\n\tbox.textcontent.readable=False\n\t\n\tform = SQLFORM(box,request.args(0))\n\tif form.process().accepted:\n\t\tresponse.flash = T(\'C\xe1\xba\xadp nh\xe1\xba\xadt th\xc3\xa0nh c\xc3\xb4ng\')\n\tdiv.append(DIV(form,_class=\'panel-body\'))\n\tresponse.view = \'plugin_sgd/ads.%s\'%request.extension\n\treturn dict(content=div)\n\t\ndef ads_page():\n\tdiv = DIV(_id=\'gian_hang\',_class=\'panel panel-default\')\n\tdiv.append(DIV(T(\'Qu\xe1\xba\xa3ng c\xc3\xa1o gian h\xc3\xa0ng\'),_class=\'panel-heading\'))\n\ttable = \'ads_img\'\n\tcms.define_table(table,True)\n\tcontent = \'\'\n\tdiv.append(DIV(content,_class=\'panel-body\'))\n\tresponse.view = \'plugin_sgd/ads.%s\'%request.extension\n\treturn dict(content=div)\n\t\n\t\n# END ADS\ndef check_url():\n\tten_url = request.vars.ten_url.lower()\n\tten_gian_hang = request.vars.ten_gian_hang\n\tdiv = DIV()\n\tif ten_gian_hang != \'\':\n\t\tif ten_url != \'\':\n\t\t\tfolder = cms.define_folder()\n\t\t\trows = cms.db(folder.name==ten_url).count()\n\t\t\tif rows>0:\n\t\t\t\tdiv.append(DIV(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 kh\xc3\xb4ng h\xe1\xbb\xa3p l\xe1\xbb\x87\',_class=\'alert alert-danger\'))\n\t\t\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'),_disabled=True)))\n\t\t\telse:\n\t\t\t\tdiv.append(DIV(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 h\xe1\xbb\xa3p l\xe1\xbb\x87\',_class=\'alert alert-success\'))\n\t\t\t\tajax = "ajax(\'%s\', [\'ten_gian_hang\',\'template\'], \'wr_add_gian_hang\')"%(URL(c=\'plugin_sgd\',f=\'add_gian_hang_admin\'))\n\t\t\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'),_onclick=ajax)))\n\t\telse:\n\t\t\tdiv.append(DIV(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 kh\xc3\xb4ng \xc4\x91\xc6\xb0\xe1\xbb\xa3c tr\xe1\xbb\x91ng\',_class=\'alert alert-danger\'))\n\t\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'),_disabled=True)))\n\telse:\n\t\tdiv.append(DIV(\'Ch\xc6\xb0a nh\xe1\xba\xadp t\xc3\xaan gian h\xc3\xa0ng\',_class=\'alert alert-danger\'))\n\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'),_disabled=True)))\t\n\treturn  div\n\t\ndef check_url1():\n\tten_url = request.vars.ten_url.lower()\n\tten_gian_hang = request.vars.ten_gian_hang\n\tdiv = DIV()\n\tif ten_gian_hang != \'\':\n\t\tif ten_url != \'\':\n\t\t\tfolder = cms.define_folder()\n\t\t\trows = cms.db(folder.name==ten_url).count()\n\t\t\tif rows>0:\n\t\t\t\tdiv.append(DIV(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 kh\xc3\xb4ng h\xe1\xbb\xa3p l\xe1\xbb\x87\',_class=\'alert alert-danger\'))\n\t\t\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_id=\'btn_submit\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'),_disabled=True)))\n\t\t\telse:\n\t\t\t\tdiv.append(DIV(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 h\xe1\xbb\xa3p l\xe1\xbb\x87\',_class=\'alert alert-success\'))\n\t\t\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_id=\'btn_submit\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'))))\n\t\telse:\n\t\t\tdiv.append(DIV(\'\xc4\x90\xe1\xbb\x8ba ch\xe1\xbb\x89 kh\xc3\xb4ng \xc4\x91\xc6\xb0\xe1\xbb\xa3c tr\xe1\xbb\x91ng\',_class=\'alert alert-danger\'))\n\t\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_id=\'btn_submit\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'),_disabled=True)))\n\telse:\n\t\tdiv.append(DIV(\'Ch\xc6\xb0a nh\xe1\xba\xadp t\xc3\xaan gian h\xc3\xa0ng\',_class=\'alert alert-danger\'))\n\t\tdiv.append(DIV(INPUT(_type=\'submit\',_class=\'btn btn-primary\',_id=\'btn_submit\',_value=T(\'T\xe1\xba\xa1o gian h\xc3\xa0ng\'),_disabled=True)))\t\n\treturn  div\n\n\n\t\n\t\n\n\nresponse._vars=response._caller(act_add_cart)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "C:\\www-sgd114\\gluon\\restricted.py", line 227, in restricted\n    exec ccode in environment\n  File "C:\\www-sgd114\\applications\\sgd\\controllers/plugin_sgd.py", line 615, in <module>\n  File "C:\\www-sgd114\\gluon\\globals.py", line 412, in <lambda>\n    self._caller = lambda f: f()\n  File "C:\\www-sgd114\\applications\\sgd\\controllers/plugin_sgd.py", line 123, in act_add_cart\n    carts = eval(request.cookies[\'cart_shop\'].value)\nKeyError: \'cart_shop\'\n'
p11
s.